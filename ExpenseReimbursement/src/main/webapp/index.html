<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Expense Reimbursement</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<style>
	</style>
</head>
<body>
<div class="container-fluid">
	<div class="row">												<!-- Header Section-->
		<nav class="navbar navbar-default text-center">
				<div class="container-fluid">
					<div class="navbar-header">
						<a class="navbar-brand" href="http://revature.com"><img src="https://3g4d13k75x47q7v53surz1gi-wpengine.netdna-ssl.com/wp-content/themes/revature/imgs/logo.png"/></a>
					</div>
					<div class="nav navbar-nav">
						<h1>Expense Reimbursement</h1>
					</div>
				</div>
				<hr>
		</nav>
	</div>
	<div  class="row">
		<main>
			<div class="col-sm-12" >
				<section id="login" style=" margin-left:25%;"> 					<!-- Login Section-->
					<div class="col-sm-6" >
						<h2 id="problem" class="text-danger"></h2>
						<form class="form-group" id="loginForm">
							<div class="form-group">
								<label for="loginUsername">Username</label>
								<input class="form-control" type="text" name="username" id="loginUsername" placeholder="Username" required/>
							</div>
							<div class="form-group">
								<label for="loginPassword">Password</label>
								<input class="form-control" type="password" name="password" id="loginPassword" placeholder="Password" required />
							</div>
							<div>
								<button class="col-sm-12 btn btn-primary" id="login-submit">Login</button>
							</div>
						</form>
					</div>					
				</section>
			</div>
			<div class="col-sm-12">							<!-- User Section-->
				<section id="user" style="display:none;">					
					<section class="row" id="userInfo">
						<div class="col-sm-5" style="float:left;">
							<div >			<!-- User Role page title-->
								<h1 id="userRole"></h1>
							</div>
						</div>
						<div class="col-sm-7 form-group" style="float:left; text-align:right; max-width:100%;">
							<div class="row">
								<div class="col-sm-4" style="float:right;">
									<button class="btn btn-danger col-sm-4 form-control"  style="display:inline-block;float:none;" id="logout" >Logout</button>
								</div>
							</div>
							<br>
							<form id="updateUserForm" class="form-group" >
								<div class="row">								<!-- logout button user info-->	
									<div class="col-sm-4">
											<input class="form-control" style="display:inline-block;" type="text" name="userFirstName" id="userFirstName" placeholder="First Name" required/>
									</div>
									<div class="col-sm-4">
											<input class="form-control" style="display:inline-block;" type="text" name="userLastName" id="userLastName" placeholder="Last Name" required/>
									</div>
									<div class="col-sm-4">
										<input class="col-sm-3 form-control" style="display:inline-block;" type="email" name="userEmail" id="userEmail" palceholder="Email" required/>
									</div>								
								</div>
								<br>
								<div class="row" >
									<div class="col-sm-4">
										<input class="form-control" style="display:inline-block;" type="text" name="username" id="username" placeholder="Username"required/>
									</div>
									<div class="col-sm-4">
										<input class="col-sm-3 form-control" style="display:inline-block;" type="password" name="userPassword" id="userPassword" placeholder="Password" required/>
									</div>
									<div class="col-sm-4">
										<button class="btn btn-primary col-sm-3 form-control" style="display:inline-block;" class="btn" id="updateUser" type="submit"   >Update</button>
									</div>
								
								</div>
							</form>
						</div>
						<div style="clear:both;"></div>
					</section>
				</section>
			</div>
			<div class="col-xs-12">									<!-- Manager Section-->
				<section id="manager" style="display:none;">	
					<div class="panel-group" id="accordion">
						<div class="row">
							<div class="panel panel-default">
								<div class="panel-heading row">
									<h4 class="panel-title">
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
											<span class="col-sm-3">Reimbursements</span>
										</a>
									</h4>
									<button class="col-sm-3 btn btn-info" id="refreshManagerReimbursementTable">Load/refresh</button>
								</div>
								<div id="collapse1" class="panel-collapse collapse in" style="overflow-x:auto;">
									<table class="table table-hover table-condensed" id="managerReimbursements">	<!--Reimbursements table-->
										<thead>
											<tr class="row">
												<th class="col-sm-1" name="ReimbursementID">ID</th>
												<th class="col-sm-1">Status</th>
												<th class="col-sm-1">Type</th>
												<th class="col-sm-1">Amount</th>
												<th class="col-sm-2">Description</th>
												<th class="col-sm-1">Employee Username</th>
												<th class="col-sm-1">Employee First Name</th>
												<th class="col-sm-1">Employee Last Name</th>
												<th class="col-sm-3">Receipt</th>
											</tr>
										</thead>
									</table>
									<form id="managerCreateReimbursmentForm">
										<table class="table table-hover table-condensed">
											<tbody >
												<tr class="row form-group" id="createNewReimbursementManager">
													<td  class="col-sm-1" name="ReimbursementID">-</td>
													<td class="col-sm-1"><button class="btn btn-primary" type="submit" id="createMRButton">Submit</button></td>
													<td class="col-sm-1" name="type"><!--Select from options in db-->
														<select class="form-control" name="type" id="managerTypeOptions" required>
															<option  class="form-control" selected="selected" disabled="disabled" >Select</option>
														</select>
													</td>
													<td class="col-sm-1" name="amount"><input class="form-control" name="amount" type="number" step="0.01" placeholder="Amount" required></td>
													<td class="col-sm-2" name="description"><textarea class="form-control" name="description" type="text" placeholder="Description"></textarea></td>
													<td class="col-sm-1">-</td>
													<td class="col-sm-1">-</td>
													<td class="col-sm-1">-</td>
													<td class="col-sm-3" name="receipt"><input class="form-control" name="receipt" type="file" placeholder="receipt" id="createMRImage"/></td>
												</tr>
											</tbody>
										</table>
									</form>
									<table class="table table-hover table-condensed">
										<tbody id="managerReimbursementTableBody">
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="panel panel-default">
								<div class="panel-heading row">
									<h4 class="panel-title">
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
											<span class="col-sm-3">Employees</span>
										</a>
									</h4>
									<button class="col-sm-3 btn btn-info" id="refreshEmployeeTable">Load/refresh</button>
								</div>
								<div id="collapse2" class="panel-collapse collapse in"  style="overflow-x:auto">									
									<table class="table table-hover table-condensed" id="employees">			<!--Employees table-->
										<thead>
											<tr class="row">
												<th  class="col-sm-1" name="employeeId">User ID</th>
												<th class="col-sm-2">Username</th>										
												<th class="col-sm-2">Role</th>
												<th class="col-sm-2">First Name</th>
												<th class="col-sm-2">Last Name</th>
												<th class="col-sm-3">Email</th>
											</tr>
										</thead>
									</table>
									<form id="createEmployeeForm">
										<table class="table table-hover table-condensed">
											<tbody id="createEmployee">
												<tr class="row form-group" >
														<td class="col-sm-1"><button class="btn btn-primary" id="createEmployeeButton" type="submit" value="Submit">Submit</button></td>		
														<td class="col-sm-2 " name="username"><input class="form-control" type="text" name="username" id="newEmployeeUsername" placeholder="username" required/></td>										
														<td class="col-sm-2" name="role">
															<select class="form-control" name="role" id="createEmployeeRoleOptions" required>
																<option selected="selected" disabled="disabled">Select</option>
															</select>
														</td>
														<td class="col-sm-2" name="firstName"><input class="form-control" type="text" name="firstName" id="newEmployeeFirstName" placeholder="firstName" required/></td>
														<td class="col-sm-2" name="lastName"><input class="form-control" type="text" name="lastName" id="newEmployeeLastName" placeholder="lastName" required/></td>
														<td class="col-sm-3" name="email"><input class="form-control" type="email" name="email" id="newEmployeeEmail" placeholder="email" required/></td>
												</tr>
												<tr class="row form-group" >
													<td class="col-sm-1"></td>
													<td class="col-sm-2" name="password"><input class="form-control" name="password" type="password" placeholder="password" required/></td>
												</tr>
											</tbody>
										</table>
									</form>
									<table class="table table-hover table-condensed">
										<tbody  id="employeeTableBody">

										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>	
				</section>
			</div>
			<div class="col-xs-12">								<!-- Employee Section-->
				<section id="employee" style="display:none;">
					<div class="panel-group" id="accordion">
						<div class="row">
							<div class="panel panel-default">
								<div class="panel-heading row">
									<h4 class="panel-title">
										<a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
											<span class="col-sm-3">Reimbursements</span>
										</a>
										<button class="col-sm-3 btn btn-info" id="refreshEmployeeReimbursementTable">Load/Refresh</button>
									</h4>
								</div>
								<div id="collapse3" class="panel-collapse collapse in" style="overflow-x:auto">	
									<table class="table table-hover table-condensed" id="employeeReimbursements">					<!--Reimbursements-->
										<thead>
											<tr class="row">
												<th class="col-sm-1">ID</th>
												<th class="col-sm-2">Status</th>
												<th class="col-sm-2">Type</th>
												<th class="col-sm-2">Amount</th>
												<th class="col-sm-2">Description</th>
												<th class="col-sm-3">Receipt</th>
											</tr>
										</thead>
									</table>
									<form id="employeeCreateReimbursementForm">
										<table class="table table-hover table-condensed" >
											<tbody>
												<tr class="row form-group" id="createNewReimbursementEmployee">
														<td class="col-sm-1"><button class="btn btn-primary" type="submit" id="createERButton">Submit</button></td>
														<td class="col-sm-2">----</td>
														<td class="col-sm-2" name="type"><!--Select from options in db-->
															<select class="form-control" name="type" id="employeeTypeOptions" required>
																<option  class="form-control" selected="selected" disabled="disabled" >Select</option>
															</select>
														</td>
														<td name="amount"><input class="form-control col-sm-2" name="amount" type="number" step="0.01" placeholder="Amount" required></td>
														<td name="description"><textarea class="form-control col-sm-2" name="description" type="text" placeholder="Description"></textarea></td>
														<td name="receipt"><input class="form-control col-sm-3" name="receipt" type="file" accept="image/*" id="createERImage"/></td>
													<!--</form>-->
												</tr>
											</tbody>
										</table>
									</form>
									<table class="table table-hover table-condensed">
										<tbody id="employeeReimbursementTableBody">

										</tbody>

									</table>

								</div>
							</div>
						</div>
					</div>
				</section>
			</div>	
		</main>
	</div>
	<div class="row">													<!-- Footer Section-->
		<div class="navbar navbar-default text-center">
			<footer>
				<hr>
				<p>Copyright &copy; 2018<p>
			</footer>
		</div>
	</div>
</div>

<script>
	function clickDisable(func, clickDisabled){
      	func();
		/*$button=$(event.target);
		console.log($button.data().events);
		button= event.target;
		button.setAttribute('disabled', true);
		func()
    	setTimeout(function(){
			button.removeAttribute('disabled');
		}, 3000);*/
	}
	var files;
	var filesBase64;
	var FR;
	window.onload = function(){
		/*
		$("#createMRImage").on("change",function(e) {
				files = e.target.files;
				FR= new FileReader();
				FR.readAsDataURL( files[0] );
				filesBase64 = FR.result;
				FR.addEventListener("load", function(e) {
					FR.readAsDataURL( files[0] );
					filesBase64 = FR.result;
				});
				//filesBase64 = FR.readAsDataURL( files[0] );
				console.log("set files");
				console.log(FR);
				console.log(files);
				console.log(filesBase64);
		});*/
		let updateClick = false;	
		document.getElementById("updateUserForm").addEventListener("submit", function(event){ event.preventDefault(); clickDisable(updateUser, updateClick);})
		let loginClick=false;
		document.getElementById("loginForm").addEventListener("submit", function(event){ event.preventDefault(); clickDisable(login, loginClick); });
		let updateUserClick = false;
		//document.getElementById("updateUser").addEventListener("click", function(){  clickDisable(updateUser, updateUserClick); });
		let logoutClick = false;
		document.getElementById("logout").addEventListener("click", function(){  clickDisable(logout, logoutClick); });
		let refreshEmployeeClick = false;
		document.getElementById("refreshEmployeeTable").addEventListener("click", function(){  clickDisable(refreshEmployeeTable, refreshEmployeeClick); });
		let refreshMRClick = false;
		document.getElementById("refreshManagerReimbursementTable").addEventListener("click", function(){  clickDisable(refreshManagerReimbursementTable, refreshMRClick); });
		let refreshERClick = false;
		document.getElementById("refreshEmployeeReimbursementTable").addEventListener("click", function(){  clickDisable(refreshEmployeeReimbursementTable, refreshERClick); });
		let createMRClick = false;
		document.getElementById("managerCreateReimbursmentForm").addEventListener('submit', function(event){ event.preventDefault(); clickDisable(createManagerReimbursement, createMRClick); });
		let createERClick = false;
		document.getElementById("employeeCreateReimbursementForm").addEventListener('submit', function(event){ event.preventDefault();  clickDisable(createEmployeeReimbursement, createERClick); });
		let createEClick = false;
		document.getElementById("createEmployeeForm").addEventListener('submit', function(event){ event.preventDefault(); clickDisable(createEmployee, createEClick); });
		//createReimbursment
		//$("#Submit-Button").on("click", createReimbursement)
	};
	function xhr(method, url, content, func){
		let xhr=new XMLHttpRequest();
		xhr.onreadystatechange = function(){
			if (this.readyState == 4 && this.status == 200) {
				let response = JSON.parse(xhr.responseText);
				if(typeof response["problem"] !='undefined'){
					document.getElementById("problem").innerHTML="Error: " + response["problem"];
					console.log("problem " + JSON.stringify(response["problem"]));
					return ;
				}else if(response.length ==0){
					document.getElementById("problem").innerHTML="Error: incomplete response. Check console";
					console.log(JSON.stringify(response));
				}else{
					for(var i=0; i<response.length; i++){
						console.log("response " + response["employees"]);					
					}
					func(response);
				}
			}else{
				if(this.status > 400){
					//logout();
					//window.location.href="http://localhost:8080/ExpenseReimbursement/Index";
				}
			}
		}
		xhr.open(method, url);
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.send(JSON.stringify(content));
	}
	function logout(){
		xhr("DELETE", "http://localhost:8080/ExpenseReimbursement/Index", null, function(response){
			window.location.href="http://localhost:8080/ExpenseReimbursement/Index";
		});
	}
	function login(e){
		let content = {};
		content.username = document.getElementById("loginUsername").value;
		content.password = document.getElementById("loginPassword").value;
		xhr("POST", "http://localhost:8080/ExpenseReimbursement/Index", content, function(response){
			document.getElementById("problem").innerHTML="Logged in";
			let userRole=response["userRole"];
			if (userRole=="Manager"){
				document.getElementById("login").style.display="none";
				setUser(response);
				document.getElementById("user").style.display="block";
				document.getElementById("manager").style.display="block";
				document.getElementById("employee").style.display="none";
				setManager(response);
			}else if(userRole=="Employee"){
				document.getElementById("login").style.display="none";
				setUser(response);
				document.getElementById("user").style.display="block";
				document.getElementById("employee").style.display="block";
				document.getElementById("manager").style.display="none";
				setEmployee(response);
			}else{
				document.getElementById("problem").innerHTML="Error: incomplete response. Check console";
				console.log(response);
			}
		});
	}
	function setUser(response){
		document.getElementById("userRole").innerHTML=response["userRole"] + "\'s Portal";
		document.getElementById("userFirstName").value=response["userFirstName"];
		document.getElementById("userLastName").value= response["userLastName"]
		document.getElementById("userEmail").value=response["email"];
		document.getElementById("username").value=response["username"];
		return;
	}
	
	function setManager(response){
		let employeeTable = document.getElementById("employeeTableBody");
		let reimbursementTable = document.getElementById("managerReimbursementTableBody");
		setOptions(response, document.getElementById("managerTypeOptions"), response.types, "type");
		setOptions(response, document.getElementById("createEmployeeRoleOptions"), response.roles, "role");
		//getAllReimbursements(reimbursementTable);
		//getAllEmployees(employeeTable);
		return;
	}
	function setEmployee(response){
		let reimbursementTable = document.getElementById("employeeReimbursementTableBody");
		setOptions(response, document.getElementById("employeeTypeOptions"), response.types, "type");
		//getEmployeeReimbursements(reimbursementTable);
		return;
	}
	function setOptions(response, select, options, key){
		if(select.children.length==1){
			for(var i=0; i< options.length; i++){
				let option=document.createElement("option");
				let optionText = document.createTextNode(options[i][key]);
				option.value=options[i].id;
				option.appendChild(optionText);
				select.appendChild(option);
			}
		}
	}
	function createEmployee(){
		let form = document.getElementById("createEmployee");
		let content= {"create": "employee"};
		let rows = form.children;	
		content.firstName=rows[0].children.firstName.children.firstName.value;
		content.lastName=rows[0].children.lastName.children.lastName.value;
		content.username=rows[0].children.username.children.username.value
		content.email=rows[0].children.email.children.email.value;
		content.password=rows[1].children.password.children.password.value;
		content.roleId=rows[0].children.role.children.role[rows[0].children.role.children.role.selectedIndex].value;
		content.role=rows[0].children.role.children.role[rows[0].children.role.children.role.selectedIndex].innerHTML;
		console.log("new employee");
		console.log(JSON.stringify(content));
		
		xhr("POST", "http://localhost:8080/ExpenseReimbursement/Manager?create=employee", content, function(response){
			if (response["create"]!=undefined){
				alert(JSON.stringify(response["create"]));
			}else{
				alert(JSON.stringify(response["problem"]));
			}
			
		});
		refreshEmployeeTable();
	}
	function createManagerReimbursement(){
		let url = "http://localhost:8080/ExpenseReimbursement/Manager?create=reimbursement";
		let row = document.getElementById("createNewReimbursementManager");
		let content= {"create": "reimbursement"};
		let cells = row.children;
		content.amount = +cells.amount.children.amount.value;
		content.description = cells.description.children.description.value;
		let receiptInput = cells.receipt.children.receipt;
		let receipt;
		content.type = +cells.type.children.type[cells.type.children.type.selectedIndex].value;
		if("files" in receiptInput){
			let files=receiptInput.files;
			if (files.length ==1){
				let fileReader = new FileReader();
				fileReader.onload=function(event){
					console.log("filereader onload");
					receipt = event.target.result;
					content.receipt=receipt;
					console.log(content);
					createReimbursement(content, "http://localhost:8080/ExpenseReimbursement/Manager?create=reimbursement");
					refreshManagerReimbursementTable();
				}
				fileReader.readAsDataURL(files[0]);
			}else if (files.length >1){
				alert("please select one file only");
				return;
			}
		}		
		//createReimbursement(content, "http://localhost:8080/ExpenseReimbursement/Manager?create=reimbursement");
		
		//console.log("end of create reimbursement");
	}
	function createEmployeeReimbursement(){
		let url = "http://localhost:8080/ExpenseReimbursement/Employee?create=reimbursement";
		let row = document.getElementById("createNewReimbursementEmployee");
		let content= {"create": "reimbursement"};
		let cells = row.children;
		content.amount = +cells.amount.children.amount.value;
		content.description = cells.description.children.description.value;
		let receiptInput = cells.receipt.children.receipt;
		let receipt;
		content.type = +cells.type.children.type[cells.type.children.type.selectedIndex].value;
			if("files" in receiptInput){
				let files=receiptInput.files;
				if (files.length ==1){
					let fileReader = new FileReader();
					fileReader.onload=function(event){
						receipt = event.target.result;
						content.receipt=receipt;
						createReimbursement(content, "http://localhost:8080/ExpenseReimbursement/Employee?create=reimbursement");
						refreshManagerReimbursementTable();
					}
					fileReader.readAsDataURL(files[0]);
				}else if (files.length >1){
					alert("please select one file only");
					return;
				}
			}
	}

	function createReimbursement(reimbursement, url){
		let reimbursements = xhr("POST", url, reimbursement, function(response){
			alert(response["create"]);
		});				
		
	}
	function refreshManagerReimbursementTable(){
		let table = document.getElementById("managerReimbursementTableBody");
		table.innerHTML ="";
		getAllReimbursements(table);
	}
	function refreshEmployeeReimbursementTable(){
		let table = document.getElementById("employeeReimbursementTableBody");
		table.innerHTML ="";
		getEmployeeReimbursements(table);
	}
	function clearTable(table){
		//let createRow = table.children[0];
		table.innerHTML="";
		//table.appendChild(createRow);
	}
	let statuses = {};
	function getAllReimbursements(reimbursementTable){
		let content= null;
		let reimbursements = xhr("GET", "http://localhost:8080/ExpenseReimbursement/Manager?get=reimbursements", content, function(response){
			let count = response["count"];
			if(count < 1){
				return;
			}
			for(var i = 0; i < response.statuses.length; i++){
				let id= response.statuses[i].id + "";
				let status=response.statuses[i].status;
				statuses[status]=id;
			}
			reimbursementTable.innerHTML="";
			let reimbursements= response["reimbursements"];
			for(var i=0; i< reimbursements.length; i++){
				let row = document.createElement("tr");
				reimbursementTable.appendChild(row);
				row.className += " row";
				let cell1=document.createElement("td");
				cell1.attributes.name="id";
				let cell11=document.createTextNode(reimbursements[i]["reimbursementId"]);
				cell1.className += " col-sm-1";
				cell1.appendChild(cell11);
				row.appendChild(cell1);
				let cell2=document.createElement("td"); //checkbox
				cell2.className += " col-sm-1";
				//row.appendChild(cell2);
				let cell3=document.createElement("td"); 
				cell3.className += " col-sm-1";
				let status = reimbursements[i]["status"];
				let cell31;
				console.log(status=="Pending");
				if(status!="Pending"){
					cell31=document.createTextNode(reimbursements[i]["status"]);
				}else{
					cell31=document.createElement("div");
					let approve=document.createElement("button");
					approve.className +=" col-sm-6 btn btn-success";
					let approveCheckmark = document.createElement("span");
					approveCheckmark.className += "glyphicon glyphicon-ok";
					approve.appendChild(approveCheckmark);
					approve.addEventListener("click", function(){ clickDisable( function(){approveReimbursement(row)}); }); 
					let deny=document.createElement("button");
					deny.addEventListener("click", function(){ clickDisable( function(){denyReimbursement(row)}); }); 
					deny.className +=" col-sm-6 btn btn-danger";
					let denyXmark = document.createElement("span");
					denyXmark.className+=" glyphicon glyphicon-remove";
					deny.appendChild(denyXmark);
					cell31.append(approve);
					cell31.append(deny);
				}
				cell3.appendChild(cell31);
				row.appendChild(cell3);
				let cell4=document.createElement("td");
				cell4.className += " col-sm-1";
				let cell41=document.createTextNode(reimbursements[i]["type"]);
				cell4.appendChild(cell41);
				row.appendChild(cell4);
				let cell5=document.createElement("td");
				cell5.className += " col-sm-1";
				let cell51=document.createTextNode("$" + reimbursements[i]["amount"].toFixed(2));
				cell5.appendChild(cell51);
				row.appendChild(cell5);
				let cell6=document.createElement("td");
				cell6.className += " col-sm-2";
				let cell61=document.createTextNode(reimbursements[i]["description"]);
				cell6.appendChild(cell61);
				row.appendChild(cell6);
				let cell7=document.createElement("td");
				cell7.className += " col-sm-1";
				let cell71=document.createTextNode(reimbursements[i]["authorUsername"]);
				cell7.appendChild(cell71);
				row.appendChild(cell7);
				let cell8=document.createElement("td");
				cell8.className += " col-sm-1";
				let cell81=document.createTextNode(reimbursements[i]["authorFirstName"]);
				cell8.appendChild(cell81);
				row.appendChild(cell8);
				let cell9=document.createElement("td");
				cell9.className += " col-sm-1";
				let cell91=document.createTextNode(reimbursements[i]["authorLastName"]);
				cell9.appendChild(cell91);
				row.appendChild(cell9);
				let cell10=document.createElement("td");
				cell10.className += " col-sm-3";
				//let cell101=document.createTextNode(reimbursements[i]["receipt"]);
				let cell101=document.createElement("img");
				if(reimbursements[i]["receiptBase64"]!=""){
					cell101.src="data:image/png;base64,"+ reimbursements[i]["receiptBase64"];
				cell10.appendChild(cell101);
				}
				cell10.appendChild(cell101);
				row.appendChild(cell10);
			}
		});
	}
	function refreshEmployeeTable(){
		let table = document.getElementById("employeeTableBody");
		table.innerHTML ="";
		getAllEmployees(table);
	}
	function getAllEmployees(employeeTable){
		let oldEmployees=employeeTable.children
		for(var i=1; i<oldEmployees.length; i++){
			employeeTable.removeChild(oldEmployees[i]);
		}
		let content= null;
		let employees = xhr("GET", "http://localhost:8080/ExpenseReimbursement/Manager?get=employees", content, function(response){
			let count = response["count"];
			if(count < 1){
				return;
			}
			employeeTable.innerHTML="";
			let employees = response["employees"];
			for(var i=0; i< employees.length; i++){
				let row = document.createElement("tr");
				row.className = "row";
				let cell1= document.createElement("td");
				cell1.className += " col-sm-1";
				let cell1text=document.createTextNode(employees[i]["userId"]);
				cell1.appendChild(cell1text);
				row.appendChild(cell1);
				let cell2= document.createElement("td");
				cell2.className += " col-sm-2";
				let cell2text=document.createTextNode(employees[i]["username"]);
				cell2.appendChild(cell2text);
				row.appendChild(cell2);
				let cell3= document.createElement("td");
				cell3.className += " col-sm-2";
				let cell3text=document.createTextNode(employees[i]["userRole"]);
				cell3.appendChild(cell3text);
				row.appendChild(cell3);
				let cell4= document.createElement("td");
				cell4.className += " col-sm-2";
				let cell4text=document.createTextNode(employees[i]["firstName"]);
				cell4.appendChild(cell4text);
				row.appendChild(cell4);
				let cell5= document.createElement("td");
				cell5.className += " col-sm-2";
				let cell5text=document.createTextNode(employees[i]["lastName"]);
				cell5.appendChild(cell5text);
				row.appendChild(cell5);
				let cell6= document.createElement("td");
				cell6.className += " col-sm-3";
				let cell6text=document.createTextNode(employees[i]["email"]);
				cell6.appendChild(cell6text);
				row.appendChild(cell6);				
				employeeTable.appendChild(row);
			}
		});
		return employees;
	}
	function getEmployeeReimbursements(reimbursementTable){
		let content= {"get": "reimbursement"};
		let reimbursements = xhr("GET", "http://localhost:8080/ExpenseReimbursement/Employee?get=reimbursements", content, function(response){
			let count = response["count"];
			reimbursementTable.innerHTML="";
			let reimbursements= response["reimbursements"];
			for(var i=0; i< reimbursements.length; i++){
				let row = document.createElement("tr");
				row.className += " row";
				let cell1=document.createElement("td");
				cell1.className += " col-sm-1";
				let cell11=document.createTextNode(reimbursements[i]["reimbursementId"]);
				cell1.appendChild(cell11);
				row.appendChild(cell1);
				let cell2=document.createElement("td"); 
				cell2.className += " col-sm-2";
				let cell21=document.createTextNode(reimbursements[i]["status"]);
				cell2.appendChild(cell21);
				row.appendChild(cell2);
				let cell3=document.createElement("td");
				cell3.className += " col-sm-2";
				let cell31=document.createTextNode(reimbursements[i]["type"]);
				cell3.appendChild(cell31);
				row.appendChild(cell3);
				let cell4=document.createElement("td");
				cell4.className += " col-sm-2";
				let cell41=document.createTextNode("$"+reimbursements[i]["amount"].toFixed(2));
				cell4.appendChild(cell41);
				row.appendChild(cell4);
				let cell5=document.createElement("td");
				cell5.className += " col-sm-2";
				let cell51=document.createTextNode(reimbursements[i]["description"]);
				cell5.appendChild(cell51);
				row.appendChild(cell5);
				let cell6=document.createElement("td");
				cell6.className += " col-sm-3";
				//let cell61=document.createTextNode(reimbursements[i]["receipt"]);
				let cell61=document.createElement("img");
				if(reimbursements[i]["receiptBase64"]!=""){
					cell61.src="data:image/png;base64,"+ reimbursements[i]["receiptBase64"];
					cell6.appendChild(cell61);
				}
				cell6.appendChild(cell61);
				row.appendChild(cell6);
				reimbursementTable.appendChild(row);
			}
		});
		
	}
	function updateUser(userId){
		let content= {"update": "user", "userId": userId};
		content.firstName=document.getElementById("userFirstName").value;
		content.lastName=document.getElementById("userLastName").value;
		content.username=document.getElementById("username").value;
		content.email=document.getElementById("userEmail").value;
		content.password=document.getElementById("userPassword").value;
		let reimbursements = xhr("PUT", "http://localhost:8080/ExpenseReimbursement/Index", content, function(response){
			console.log(JSON.stringify());
			alert(response["update"]);
		});
	}
	function approveReimbursement(reimbursementRow){
		let reimbursement = {};
		let id = +reimbursementRow.children[0].textContent;
		reimbursement.id=id;
		console.log("statuses");
		console.log(statuses);
		console.log("statuses");
		reimbursement.statusId=+statuses.Approved;
		updateReimbursement(reimbursement);
	}
	function denyReimbursement(reimbursementRow){
		let reimbursement = {};
		let id = +reimbursementRow.children[0].textContent;
		reimbursement.id=id;
		reimbursement.statusId=+statuses.Denied;
		updateReimbursement(reimbursement);
	}
	function updateReimbursement(reimbursement){
		let content= reimbursement;
		content.update="reimbursement";
		console.log(JSON.stringify(content));
		xhr("PUT", "http://localhost:8080/ExpenseReimbursement/Manager?update=reimbursement", content, function(response){
			alert(response["update"]);
			refreshManagerReimbursementTable();
		});
	}
	
</script>
</body>
</html>